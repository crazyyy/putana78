{"version":3,"sources":["selectivizr.js"],"names":["win","patchStyleSheet","cssText","replace","RE_PSEUDO_ELEMENTS","PLACEHOLDER_STRING","RE_SELECTOR_GROUP","m","prefix","selectorText","selectorGroups","split","c","cs","length","selector","normalizeSelectorWhitespace","SPACE_STRING","patches","RE_SELECTOR_PARSE","match","combinator","pseudo","attribute","index","domPatches","push","substring","patch","patchPseudoClass","patchAttribute","className","join","attr","BROKEN_ATTR_IMPLEMENTATIONS","test","createClassName","applyClass","activateEventName","deactivateEventName","slice","isNegated","bracketIndex","indexOf","charAt","e","root","ieVersion","handler","hash","location","hashID","EMPTY_STRING","id","addEvent","toggleElementClass","RE_INPUT_CHECKABLE_TYPES","type","event","propertyName","checked","RE_INPUT_ELEMENTS","tagName","$disabled","enabledWatchers","disabled","RE_PSEUDO_STRUCTURAL","applyPatches","elms","domSelectorText","RE_LIBRARY_INCOMPATIBLE_PSEUDOS","selectorMethod","ex","log","d","dl","elm","cssClasses","f","fl","hasPatch","toggleClass","RegExp","namespace","patchIE6MultipleClasses","ie6PatchID","RE_PATCH_CLASS_NAME_REPLACE","a","charCodeAt","message","console","trim","text","RE_TIDY_TRIM_WHITESPACE","normalizeWhitespace","RE_TIDY_CONSECUTIVE_WHITESPACE","RE_TIDY_TRAILING_WHITESPACE","RE_TIDY_LEADING_WHITESPACE","on","oldClassName","newClassName","parentNode","classList","re","classExists","eventName","eventHandler","attachEvent","getXHRObject","XMLHttpRequest","ActiveXObject","loadStyleSheet","url","xhr","open","send","status","responseText","resolveUrl","contextUrl","ignoreSameOriginPolicy","getProtocol","getProtocolAndHost","baseUrl","contextUrlPath","lastIndexOf","parseStyleSheet","RE_COMMENT","RE_IMPORT","quoteChar","importUrl","quoteChar2","importUrl2","media","RE_ASSET_URL","isBehavior","assetUrl","getStyleSheets","stylesheet","doc","styleSheets","href","init","setInterval","cl","ContentLoaded","fn","done","top","readyState","detachEvent","call","poll","doScroll","setTimeout","createEventObject","frameElement","ieUserAgent","navigator","userAgent","document","documentElement","compatMode","selectorEngines","NW","MooTools","DOMAssistant","Prototype","YAHOO","Sizzle","jQuery","dojo","baseTags","getElementsByTagName","engine","members","member","context","shift","this"],"mappings":"CA0BA,SAAUA,GAgFR,QAASC,GAAiBC,GACxB,MAAOA,GAAQC,QAAQC,EAAoBC,GACzCF,QAAQG,EAAmB,SAASC,EAAGC,EAAQC,GAE3C,IAAK,GADDC,GAAiBD,EAAaE,MAAM,KAC/BC,EAAI,EAAGC,EAAKH,EAAeI,OAAYD,EAAJD,EAAQA,IAAK,CACvD,GAAIG,GAAWC,EAA4BN,EAAeE,IAAMK,EAC5DC,IACJR,GAAeE,GAAKG,EAASZ,QAAQgB,EACnC,SAASC,EAAOC,EAAYC,EAAQC,EAAWC,GAC7C,GAAIH,EAKF,MAJIH,GAAQJ,OAAO,IACjBW,EAAWC,MAAQX,SAAUA,EAASY,UAAU,EAAGH,GAAQN,QAASA,IACpEA,MAEKG,CAGP,IAAIO,GAAQ,EAAWC,EAAkBP,GAAWQ,EAAgBP,EACpE,OAAIK,IACFV,EAAQQ,KAAKE,GACN,IAAMA,EAAMG,WAEdX,IAKf,MAAOZ,GAASE,EAAesB,KAAK,OAM5C,QAASF,GAAgBG,GACvB,OAASC,GAA+BA,EAA4BC,KAAKF,IACrEF,UAAWK,EAAgBH,GAAOI,YAAY,GAAS,KAK7D,QAASR,GAAkBP,GAEzB,GAGIgB,GACAC,EAJAF,GAAa,EACbN,EAAYK,EAAgBd,EAAOkB,MAAM,IACzCC,EAAsC,SAA1BnB,EAAOK,UAAU,EAAG,EAKhCc,KACFnB,EAASA,EAAOkB,MAAM,EAAG,IAI3B,IAAIE,GAAepB,EAAOqB,QAAQ,IAMlC,IALID,EAAe,KACjBpB,EAASA,EAAOK,UAAU,EAAGe,IAIP,KAApBpB,EAAOsB,OAAO,GAChB,OAAQtB,EAAOkB,MAAM,IAEnB,IAAK,OACHH,EAAa,SAASQ,GACpB,MAAOJ,GAAYI,GAAKC,EAAOD,GAAKC,EAEtC,MAEF,KAAK,SAEH,GAAiB,GAAbC,EAAgB,CAClBV,EAAa,SAASQ,GACpB,GAAIG,GAAU,WACZ,GAAIC,GAAOC,SAASD,KAChBE,EAASF,EAAKT,MAAM,EACxB,OAAOC,GAAaQ,GAAQG,GAAgBP,EAAEQ,IAAMF,EAAWF,GAAQG,GAAgBP,EAAEQ,IAAMF,EAKjG,OAHAG,GAAUtD,EAAK,aAAc,WAC3BuD,EAAmBV,EAAGd,EAAWiB,OAE5BA,IAET,OAEF,OAAO,CAET,KAAK,UACHX,EAAa,SAASQ,GAQpB,MAPIW,GAAyBrB,KAAKU,EAAEY,OAClCH,EAAUT,EAAG,iBAAkB,WACH,WAAtBa,MAAMC,cACRJ,EAAoBV,EAAGd,EAAWc,EAAEe,UAAYnB,KAI/CI,EAAEe,UAAYnB,EAEvB,MAEF,KAAK,WACHA,GAAaA,CAEf,KAAK,UACHJ,EAAa,SAASQ,GACpB,MAAIgB,GAAkB1B,KAAKU,EAAEiB,UAC3BR,EAAUT,EAAG,iBAAkB,WACH,aAAtBa,MAAMC,cACRJ,EAAoBV,EAAGd,EAAWc,EAAEkB,YAActB,KAGtDuB,EAAgBtC,KAAKmB,GACrBA,EAAEkB,UAAYlB,EAAEoB,SACTpB,EAAEoB,WAAaxB,GAEP,YAAVnB,EAAuBmB,GAAaA,EAE7C,MAEF,KAAK,QACHH,EAAoB,QACpBC,EAAsB,MAExB,KAAK,QACED,IACHA,EAAoB,aACpBC,EAAsB,cAExBF,EAAa,SAASQ,GAOpB,MANAS,GAAUT,EAAGJ,EAAYF,EAAsBD,EAAmB,WAChEiB,EAAoBV,EAAGd,GAAW,KAEpCuB,EAAUT,EAAGJ,EAAYH,EAAoBC,EAAqB,WAChEgB,EAAoBV,EAAGd,GAAW,KAE7BU,EAET,MAGF,SAGE,IAAKyB,EAAqB/B,KAAKb,GAC7B,OAAO,EAKf,OAASS,UAAWA,EAAWM,WAAYA,GAI7C,QAAS8B,KAGP,IAAK,GAFDC,GAAM3D,EAAcS,EAASmD,EAExBzD,EAAE,EAAGA,EAAEa,EAAWX,OAAQF,IAAK,CACtCH,EAAegB,EAAWb,GAAGG,SAC7BG,EAAUO,EAAWb,GAAGM,QAKxBmD,EAAkB5D,EAAaN,QAAQmE,EAAiClB,GAIpEiB,GAAmBjB,GAAgBiB,EAAgBzB,OAAOyB,EAAgBvD,OAAS,IAAMG,IAC3FoD,GAAmB,IAIrB,KACED,EAAOG,EAAgBF,GACvB,MAAOG,GAEPC,EAAK,aAAehE,EAAe,sBAAwB+D,EAAK,KAKlE,GAAIJ,EACF,IAAK,GAAIM,GAAI,EAAGC,EAAKP,EAAKtD,OAAY6D,EAAJD,EAAQA,IAAK,CAG7C,IAAK,GAFDE,GAAMR,EAAKM,GACXG,EAAaD,EAAI7C,UACZ+C,EAAI,EAAGC,EAAK7D,EAAQJ,OAAYiE,EAAJD,EAAQA,IAAK,CAChD,GAAIlD,GAAQV,EAAQ4D,EACfE,GAASJ,EAAKhD,KACbA,EAAMS,YAAeT,EAAMS,cAAe,GAAQT,EAAMS,WAAWuC,MAAS,IAC9EC,EAAaI,EAAYJ,EAAYjD,EAAMG,WAAW,IAI5D6C,EAAI7C,UAAY8C,IAQxB,QAASG,GAAUJ,EAAKhD,GACtB,MAAO,IAAIsD,QAAO,UAAYtD,EAAMG,UAAY,WAAWI,KAAKyC,EAAI7C,WAMtE,QAASK,GAAiBL,GACxB,MAAOoD,GAAY,KAAqB,GAAbpC,GAAkBqC,EAC3CC,IAEAtD,EAAU5B,QAAQmF,EAA6B,SAASC,GAAK,MAAOA,GAAEC,WAAW,MAKrF,QAASf,GAAKgB,GACRzF,EAAI0F,SACN1F,EAAI0F,QAAQjB,IAAIgB,GAOpB,QAASE,GAAMC,GACb,MAAOA,GAAKzF,QAAQ0F,EAAyBxF,GAK/C,QAASyF,GAAqBF,GAC5B,MAAOD,GAAKC,GAAMzF,QAAQ4F,EAAgC9E,GAK5D,QAASD,GAA6BP,GACpC,MAAOqF,GAAoBrF,EACzBN,QAAQ6F,EAA6B3F,GACrCF,QAAQ8F,EAA4B5F,IAMxC,QAASkD,GAAoBqB,EAAK7C,EAAWmE,GAC3C,GAAIC,GAAevB,EAAI7C,UACnBqE,EAAenB,EAAYkB,EAAcpE,EAAWmE,EACpDE,IAAgBD,IAClBvB,EAAI7C,UAAYqE,EAChBxB,EAAIyB,WAAWtE,WAAaqB,GAOhC,QAAS6B,GAAaqB,EAAWvE,EAAWmE,GAC1C,GAAIK,GAAKrB,OAAO,UAAYnD,EAAY,WACpCyE,EAAcD,EAAGpE,KAAKmE,EAC1B,OAAIJ,GACKM,EAAcF,EAAYA,EAAYrF,EAAec,EAErDyE,EAAcb,EAAKW,EAAUnG,QAAQoG,EAAIlG,IAAuBiG,EAK3E,QAAShD,GAASsB,EAAK6B,EAAWC,GAChC9B,EAAI+B,YAAY,KAAOF,EAAWC,GAIpC,QAASE,KACP,GAAI5G,EAAI6G,eACN,MAAO,IAAIA,eAEb,KACE,MAAO,IAAIC,eAAc,qBACzB,MAAMjE,GACN,MAAO,OAKX,QAASkE,GAAgBC,GAGvB,MAFAC,GAAIC,KAAK,MAAOF,GAAK,GACrBC,EAAIE,OACgB,KAAZF,EAAIG,OAAeH,EAAII,aAAejE,EAMhD,QAASkE,GAAYN,EAAKO,EAAYC,GAEpC,QAASC,GAAaT,GACpB,MAAOA,GAAIrF,UAAU,EAAGqF,EAAIrE,QAAQ,OAGtC,QAAS+E,GAAoBV,GAC3B,MAAOA,GAAIrF,UAAU,EAAGqF,EAAIrE,QAAQ,IAAK,IAa3C,GAVK4E,IACHA,EAAaI,GAIS,MAApBX,EAAIrF,UAAU,EAAE,KAClBqF,EAAMS,EAAYF,GAAcP,GAI9B,gBAAgB7E,KAAK6E,GACvB,MAAQQ,IAA0BE,EAAmBH,IAAeG,EAAmBV,GAAcA,EAAP,IAIhG,IAAmB,KAAfA,EAAIpE,OAAO,GACb,MAAO8E,GAAmBH,GAAcP,CAI1C,IAAIY,GAAiBL,EAAW5G,MAAM,QAAQ,EAK9C,OAJqB,KAAjBqG,EAAIpE,OAAO,IAAiE,KAApDgF,EAAehF,OAAOgF,EAAe9G,OAAS,KACxE8G,EAAiBA,EAAejG,UAAU,EAAGiG,EAAeC,YAAY,KAAO,IAG1ED,EAAiBZ,EAO1B,QAASc,GAAiBd,GACxB,MAAIA,GACKD,EAAeC,GAAK7G,QAAQ4H,EAAY3E,GAC/CjD,QAAQ6H,EAAW,SAAU5G,EAAO6G,EAAWC,EAAWC,EAAYC,EAAYC,GAChF,GAAInI,GAAU4H,EAAgBR,EAAWY,GAAaE,EAAYpB,GAClE,OAAO,GAAU,UAAYqB,EAAQ,KAAOnI,EAAU,IAAMA,IAE9DC,QAAQmI,EAAc,SAAUlH,EAAOmH,EAAYN,EAAWO,GAE5D,MADAP,GAAYA,GAAa7E,EAClBmF,EAAanH,EAAQ,QAAU6G,EAAYX,EAAWkB,EAAUxB,GAAK,GAAQiB,EAAY,OAG7F7E,EAIT,QAASqF,KAEP,IAAK,GADDzB,GAAK0B,EACA9H,EAAI,EAAGA,EAAI+H,EAAIC,YAAY9H,OAAQF,IAC1C8H,EAAaC,EAAIC,YAAYhI,GACzB8H,EAAWG,MAAQzF,IACrB4D,EAAMM,EAAWoB,EAAWG,MACxB7B,IACF0B,EAAWxI,QAAUwI,EAAuB,WAAIzI,EAAiB6H,EAAiBd,MAO1F,QAAS8B,KACP3E,IAIIH,EAAgBlD,OAAS,GAC3BiI,YAAa,WACX,IAAK,GAAInI,GAAI,EAAGoI,EAAKhF,EAAgBlD,OAAYkI,EAAJpI,EAAQA,IAAK,CACxD,GAAIiC,GAAImB,EAAgBpD,EACpBiC,GAAEoB,WAAapB,EAAEkB,YACflB,EAAEoB,UACJpB,EAAEoB,UAAW,EACbpB,EAAEkB,WAAY,EACdlB,EAAEoB,UAAW,GAGbpB,EAAEkB,UAAYlB,EAAEoB,YAIrB,KA6CP,QAASgF,GAAcjJ,EAAKkJ,GAE1B,GAAIC,IAAO,EAAOC,GAAM,EACxBN,EAAO,SAASjG,GACA,oBAAVA,EAAEY,MAAgD,YAAlBkF,EAAIU,cAC7B,QAAVxG,EAAEY,KAAiBzD,EAAM2I,GAAKW,YAAY,KAAOzG,EAAEY,KAAMqF,GAAM,IAC3DK,IAASA,GAAO,IAAOD,EAAGK,KAAKvJ,EAAK6C,EAAEY,MAAQZ,KAErD2G,EAAO,WACL,IAAM1G,EAAK2G,SAAS,QAAW,MAAM5G,GAA2B,WAAtB6G,YAAWF,EAAM,IAC3DV,EAAK,QAGP,IAAsB,YAAlBH,EAAIU,WAA0BH,EAAGK,KAAKvJ,EAAKoD,OAC1C,CACH,GAAIuF,EAAIgB,mBAAqB7G,EAAK2G,SAAU,CAC1C,IAAML,GAAOpJ,EAAI4J,aAAgB,MAAM/G,IACnCuG,GAAKI,IAEXlG,EAASqF,EAAI,mBAAoBG,GACjCxF,EAAStD,EAAI,OAAQ8I,IAhhBzB,GAAIe,GAAcC,UAAUC,UAAU3I,MAAM,aAC5C,KAAKyI,EACH,OAAO,CAKT,IAAIlB,GAAMqB,SACNlH,EAAO6F,EAAIsB,gBACXhD,EAAML,IACN7D,EAAY8G,EAAY,EAI5B,MAAsB,cAAlBlB,EAAIuB,YAAwC,EAAVnH,GAAeA,EAAU,IAAMkE,EAArE,CASA,GAWI1C,GAXA4F,GACFC,GAAsB,eACtBC,SAA0B,KAC1BC,aAA4B,MAC5BC,UAA2B,KAC3BC,MAAyB,wBACzBC,OAAwB,IACxBC,OAAwB,IACxBC,KAAwB,WAItB3G,KACAvC,KACA4D,EAA2B,EAC3BD,GAAiC,EACjCD,EAA0B,QAG1B4C,EAA0B,wCAC1BC,EAAyB,gFACzBM,EAA2B,iEAC3BpE,EAA8B,2DAC9B9D,EAA8B,6BAC9BE,EAA6B,+DAC7Ba,EAA6B,8CAC7BmD,EAAqC,qGACrCgB,EAAmC,UAGnCzB,EAA6B,mCAC7BL,EAAgC,qBAGhCtB,EAAmCa,EAAU,EAAI,mBAAqB,KAGtEiD,EAAmC,gBACnCC,EAAkC,gBAClCF,EAAoC,OACpCF,EAAiC,2BAGjCzC,EAA0B,GAC1BnC,EAA0B,IAC1BZ,EAA8B,KAgZ9BuK,EAAWjC,EAAIkC,qBAAqB,QACpClD,EAAWiD,EAAS9J,OAAS,EAAK8J,EAAS,GAAG/B,KAAOF,EAAIzF,SAAS2F,IACtEJ,KAGAQ,EAAcjJ,EAAK,WAEjB,IAAK,GAAI8K,KAAUX,GAAiB,CAClC,GAAIY,GAASC,EAAQC,EAAUjL,CAC/B,IAAIA,EAAI8K,GAAS,CAEf,IADAC,EAAUZ,EAAgBW,GAAQ3K,QAAQ,IAAK2K,GAAQnK,MAAM,MACrDqK,EAASD,EAAQG,WAAaD,EAAUA,EAAQD,MACxD,GAAsB,kBAAXC,GAGT,MAFA1G,GAAiB0G,MACjBnC,WAiDPqC","file":"selectivizr.js","sourcesContent":["/*\nselectivizr v1.0.3b - (c) Keith Clark, freely distributable under the terms\nof the MIT license.\n\nselectivizr.com\n*/\n/*\n\nNotes about this source\n-----------------------\n\n * The #DEBUG_START and #DEBUG_END comments are used to mark blocks of code\n   that will be removed prior to building a final release version (using a\n   pre-compression script)\n\n\nReferences:\n-----------\n\n * CSS Syntax          : http://www.w3.org/TR/2003/WD-css3-syntax-20030813/#style\n * Selectors           : http://www.w3.org/TR/css3-selectors/#selectors\n * IE Compatability    : http://msdn.microsoft.com/en-us/library/cc351024(VS.85).aspx\n * W3C Selector Tests  : http://www.w3.org/Style/CSS/Test/CSS3/Selectors/current/html/tests/\n\n*/\n\n(function(win) {\n\n  // Determine IE version and stop execution if browser isn't IE. This\n  // handles the script being loaded by non IE browsers because the\n  // developer didn't use conditional comments.\n  var ieUserAgent = navigator.userAgent.match(/MSIE (\\d+)/);\n  if (!ieUserAgent) {\n    return false;\n  }\n\n  // =========================== Init Objects ============================\n\n  var doc = document;\n  var root = doc.documentElement;\n  var xhr = getXHRObject();\n  var ieVersion = ieUserAgent[1];\n\n  // If were not in standards mode, IE is too old / new or we can't create\n  // an XMLHttpRequest object then we should get out now.\n  if (doc.compatMode != 'CSS1Compat' || ieVersion<6 || ieVersion>8 || !xhr) {\n    return;\n  }\n\n\n  // ========================= Common Objects ============================\n\n  // Compatiable selector engines in order of CSS3 support. Note: '*' is\n  // a placholder for the object key name. (basically, crude compression)\n  var selectorEngines = {\n    \"NW\"                : \"*.Dom.select\",\n    \"MooTools\"              : \"$$\",\n    \"DOMAssistant\"            : \"*.$\",\n    \"Prototype\"              : \"$$\",\n    \"YAHOO\"                : \"*.util.Selector.query\",\n    \"Sizzle\"              : \"*\",\n    \"jQuery\"              : \"*\",\n    \"dojo\"                : \"*.query\"\n  };\n\n  var selectorMethod;\n  var enabledWatchers           = [];     // array of :enabled/:disabled elements to poll\n  var domPatches              = [];\n  var ie6PatchID               = 0;      // used to solve ie6's multiple class bug\n  var patchIE6MultipleClasses        = true;   // if true adds class bloat to ie6\n  var namespace               = \"slvzr\";\n\n  // Stylesheet parsing regexp's\n  var RE_COMMENT              = /(\\/\\*[^*]*\\*+([^\\/][^*]*\\*+)*\\/)\\s*?/g;\n  var RE_IMPORT              = /@import\\s*(?:(?:(?:url\\(\\s*(['\"]?)(.*)\\1)\\s*\\))|(?:(['\"])(.*)\\3))\\s*([^;]*);/g;\n  var RE_ASSET_URL             = /(behavior\\s*?:\\s*)?\\burl\\(\\s*([\"']?)(?!data:)([^\"')]+)\\2\\s*\\)/g;\n  var RE_PSEUDO_STRUCTURAL        = /^:(empty|(first|last|only|nth(-last)?)-(child|of-type))$/;\n  var RE_PSEUDO_ELEMENTS          = /:(:first-(?:line|letter))/g;\n  var RE_SELECTOR_GROUP          = /((?:^|(?:\\s*})+)(?:\\s*@media[^{]+{)?)\\s*([^\\{]*?[\\[:][^{]+)/g;\n  var RE_SELECTOR_PARSE          = /([ +~>])|(:[a-z-]+(?:\\(.*?\\)+)?)|(\\[.*?\\])/g;\n  var RE_LIBRARY_INCOMPATIBLE_PSEUDOS    = /(:not\\()?:(hover|enabled|disabled|focus|checked|target|active|visited|first-line|first-letter)\\)?/g;\n  var RE_PATCH_CLASS_NAME_REPLACE      = /[^\\w-]/g;\n\n  // HTML UI element regexp's\n  var RE_INPUT_ELEMENTS          = /^(INPUT|SELECT|TEXTAREA|BUTTON)$/;\n  var RE_INPUT_CHECKABLE_TYPES      = /^(checkbox|radio)$/;\n\n  // Broken attribute selector implementations (IE7/8 native [^=\"\"], [$=\"\"] and [*=\"\"])\n  var BROKEN_ATTR_IMPLEMENTATIONS      = ieVersion>6 ? /[\\$\\^*]=(['\"])\\1/ : null;\n\n  // Whitespace normalization regexp's\n  var RE_TIDY_TRAILING_WHITESPACE      = /([(\\[+~])\\s+/g;\n  var RE_TIDY_LEADING_WHITESPACE      = /\\s+([)\\]+~])/g;\n  var RE_TIDY_CONSECUTIVE_WHITESPACE    = /\\s+/g;\n  var RE_TIDY_TRIM_WHITESPACE        = /^\\s*((?:[\\S\\s]*\\S)?)\\s*$/;\n\n  // String constants\n  var EMPTY_STRING            = \"\";\n  var SPACE_STRING            = \" \";\n  var PLACEHOLDER_STRING          = \"$1\";\n\n  // =========================== Patching ================================\n\n  // --[ patchStyleSheet() ]----------------------------------------------\n  // Scans the passed cssText for selectors that require emulation and\n  // creates one or more patches for each matched selector.\n  function patchStyleSheet( cssText ) {\n    return cssText.replace(RE_PSEUDO_ELEMENTS, PLACEHOLDER_STRING).\n      replace(RE_SELECTOR_GROUP, function(m, prefix, selectorText) {\n          var selectorGroups = selectorText.split(\",\");\n          for (var c = 0, cs = selectorGroups.length; c < cs; c++) {\n            var selector = normalizeSelectorWhitespace(selectorGroups[c]) + SPACE_STRING;\n            var patches = [];\n            selectorGroups[c] = selector.replace(RE_SELECTOR_PARSE,\n              function(match, combinator, pseudo, attribute, index) {\n                if (combinator) {\n                  if (patches.length>0) {\n                    domPatches.push( { selector: selector.substring(0, index), patches: patches } )\n                    patches = [];\n                  }\n                  return combinator;\n                }\n                else {\n                  var patch = (pseudo) ? patchPseudoClass( pseudo ) : patchAttribute( attribute );\n                  if (patch) {\n                    patches.push(patch);\n                    return \".\" + patch.className;\n                  }\n                  return match;\n                }\n              }\n            );\n          }\n          return prefix + selectorGroups.join(\",\");\n        });\n  };\n\n  // --[ patchAttribute() ]-----------------------------------------------\n  // returns a patch for an attribute selector.\n  function patchAttribute( attr ) {\n    return (!BROKEN_ATTR_IMPLEMENTATIONS || BROKEN_ATTR_IMPLEMENTATIONS.test(attr)) ?\n      { className: createClassName(attr), applyClass: true } : null;\n  };\n\n  // --[ patchPseudoClass() ]---------------------------------------------\n  // returns a patch for a pseudo-class\n  function patchPseudoClass( pseudo ) {\n\n    var applyClass = true;\n    var className = createClassName(pseudo.slice(1));\n    var isNegated = pseudo.substring(0, 5) == \":not(\";\n    var activateEventName;\n    var deactivateEventName;\n\n    // if negated, remove :not()\n    if (isNegated) {\n      pseudo = pseudo.slice(5, -1);\n    }\n\n    // bracket contents are irrelevant - remove them\n    var bracketIndex = pseudo.indexOf(\"(\")\n    if (bracketIndex > -1) {\n      pseudo = pseudo.substring(0, bracketIndex);\n    }\n\n    // check we're still dealing with a pseudo-class\n    if (pseudo.charAt(0) == \":\") {\n      switch (pseudo.slice(1)) {\n\n        case \"root\":\n          applyClass = function(e) {\n            return isNegated ? e != root : e == root;\n          }\n          break;\n\n        case \"target\":\n          // :target is only supported in IE8\n          if (ieVersion == 8) {\n            applyClass = function(e) {\n              var handler = function() {\n                var hash = location.hash;\n                var hashID = hash.slice(1);\n                return isNegated ? (hash == EMPTY_STRING || e.id != hashID) : (hash != EMPTY_STRING && e.id == hashID);\n              };\n              addEvent( win, \"hashchange\", function() {\n                toggleElementClass(e, className, handler());\n              })\n              return handler();\n            }\n            break;\n          }\n          return false;\n\n        case \"checked\":\n          applyClass = function(e) {\n            if (RE_INPUT_CHECKABLE_TYPES.test(e.type)) {\n              addEvent( e, \"propertychange\", function() {\n                if (event.propertyName == \"checked\") {\n                  toggleElementClass( e, className, e.checked !== isNegated );\n                }\n              })\n            }\n            return e.checked !== isNegated;\n          }\n          break;\n\n        case \"disabled\":\n          isNegated = !isNegated;\n\n        case \"enabled\":\n          applyClass = function(e) {\n            if (RE_INPUT_ELEMENTS.test(e.tagName)) {\n              addEvent( e, \"propertychange\", function() {\n                if (event.propertyName == \"$disabled\") {\n                  toggleElementClass( e, className, e.$disabled === isNegated );\n                }\n              });\n              enabledWatchers.push(e);\n              e.$disabled = e.disabled;\n              return e.disabled === isNegated;\n            }\n            return pseudo == \":enabled\" ? isNegated : !isNegated;\n          }\n          break;\n\n        case \"focus\":\n          activateEventName = \"focus\";\n          deactivateEventName = \"blur\";\n\n        case \"hover\":\n          if (!activateEventName) {\n            activateEventName = \"mouseenter\";\n            deactivateEventName = \"mouseleave\";\n          }\n          applyClass = function(e) {\n            addEvent( e, isNegated ? deactivateEventName : activateEventName, function() {\n              toggleElementClass( e, className, true );\n            })\n            addEvent( e, isNegated ? activateEventName : deactivateEventName, function() {\n              toggleElementClass( e, className, false );\n            })\n            return isNegated;\n          }\n          break;\n\n        // everything else\n        default:\n          // If we don't support this pseudo-class don't create\n          // a patch for it\n          if (!RE_PSEUDO_STRUCTURAL.test(pseudo)) {\n            return false;\n          }\n          break;\n      }\n    }\n    return { className: className, applyClass: applyClass };\n  };\n\n  // --[ applyPatches() ]-------------------------------------------------\n  function applyPatches() {\n    var elms, selectorText, patches, domSelectorText;\n\n    for (var c=0; c<domPatches.length; c++) {\n      selectorText = domPatches[c].selector;\n      patches = domPatches[c].patches;\n\n      // Although some selector libraries can find :checked :enabled etc.\n      // we need to find all elements that could have that state because\n      // it can be changed by the user.\n      domSelectorText = selectorText.replace(RE_LIBRARY_INCOMPATIBLE_PSEUDOS, EMPTY_STRING);\n\n      // If the dom selector equates to an empty string or ends with\n      // whitespace then we need to append a universal selector (*) to it.\n      if (domSelectorText == EMPTY_STRING || domSelectorText.charAt(domSelectorText.length - 1) == SPACE_STRING) {\n        domSelectorText += \"*\";\n      }\n\n      // Ensure we catch errors from the selector library\n      try {\n        elms = selectorMethod( domSelectorText );\n      } catch (ex) {\n        // #DEBUG_START\n        log( \"Selector '\" + selectorText + \"' threw exception '\" + ex + \"'\" );\n        // #DEBUG_END\n      }\n\n\n      if (elms) {\n        for (var d = 0, dl = elms.length; d < dl; d++) {\n          var elm = elms[d];\n          var cssClasses = elm.className;\n          for (var f = 0, fl = patches.length; f < fl; f++) {\n            var patch = patches[f];\n            if (!hasPatch(elm, patch)) {\n              if (patch.applyClass && (patch.applyClass === true || patch.applyClass(elm) === true)) {\n                cssClasses = toggleClass(cssClasses, patch.className, true );\n              }\n            }\n          }\n          elm.className = cssClasses;\n        }\n      }\n    }\n  };\n\n  // --[ hasPatch() ]-----------------------------------------------------\n  // checks for the exsistence of a patch on an element\n  function hasPatch( elm, patch ) {\n    return new RegExp(\"(^|\\\\s)\" + patch.className + \"(\\\\s|$)\").test(elm.className);\n  };\n\n\n  // =========================== Utility =================================\n\n  function createClassName( className ) {\n    return namespace + \"-\" + ((ieVersion == 6 && patchIE6MultipleClasses) ?\n      ie6PatchID++\n    :\n      className.replace(RE_PATCH_CLASS_NAME_REPLACE, function(a) { return a.charCodeAt(0) }));\n  };\n\n  // --[ log() ]----------------------------------------------------------\n  // #DEBUG_START\n  function log( message ) {\n    if (win.console) {\n      win.console.log(message);\n    }\n  };\n  // #DEBUG_END\n\n  // --[ trim() ]---------------------------------------------------------\n  // removes leading, trailing whitespace from a string\n  function trim( text ) {\n    return text.replace(RE_TIDY_TRIM_WHITESPACE, PLACEHOLDER_STRING);\n  };\n\n  // --[ normalizeWhitespace() ]------------------------------------------\n  // removes leading, trailing and consecutive whitespace from a string\n  function normalizeWhitespace( text ) {\n    return trim(text).replace(RE_TIDY_CONSECUTIVE_WHITESPACE, SPACE_STRING);\n  };\n\n  // --[ normalizeSelectorWhitespace() ]----------------------------------\n  // tidies whitespace around selector brackets and combinators\n  function normalizeSelectorWhitespace( selectorText ) {\n    return normalizeWhitespace(selectorText.\n      replace(RE_TIDY_TRAILING_WHITESPACE, PLACEHOLDER_STRING).\n      replace(RE_TIDY_LEADING_WHITESPACE, PLACEHOLDER_STRING)\n    );\n  };\n\n  // --[ toggleElementClass() ]-------------------------------------------\n  // toggles a single className on an element\n  function toggleElementClass( elm, className, on ) {\n    var oldClassName = elm.className;\n    var newClassName = toggleClass(oldClassName, className, on);\n    if (newClassName != oldClassName) {\n      elm.className = newClassName;\n      elm.parentNode.className += EMPTY_STRING;\n    }\n  };\n\n  // --[ toggleClass() ]--------------------------------------------------\n  // adds / removes a className from a string of classNames. Used to\n  // manage multiple class changes without forcing a DOM redraw\n  function toggleClass( classList, className, on ) {\n    var re = RegExp(\"(^|\\\\s)\" + className + \"(\\\\s|$)\");\n    var classExists = re.test(classList);\n    if (on) {\n      return classExists ? classList : classList + SPACE_STRING + className;\n    } else {\n      return classExists ? trim(classList.replace(re, PLACEHOLDER_STRING)) : classList;\n    }\n  };\n\n  // --[ addEvent() ]-----------------------------------------------------\n  function addEvent(elm, eventName, eventHandler) {\n    elm.attachEvent(\"on\" + eventName, eventHandler);\n  };\n\n  // --[ getXHRObject() ]-------------------------------------------------\n  function getXHRObject() {\n    if (win.XMLHttpRequest) {\n      return new XMLHttpRequest;\n    }\n    try  {\n      return new ActiveXObject('Microsoft.XMLHTTP');\n    } catch(e) {\n      return null;\n    }\n  };\n\n  // --[ loadStyleSheet() ]-----------------------------------------------\n  function loadStyleSheet( url ) {\n    xhr.open(\"GET\", url, false);\n    xhr.send();\n    return (xhr.status==200) ? xhr.responseText : EMPTY_STRING;\n  };\n\n  // --[ resolveUrl() ]---------------------------------------------------\n  // Converts a URL fragment to a fully qualified URL using the specified\n  // context URL. Returns null if same-origin policy is broken\n  function resolveUrl( url, contextUrl, ignoreSameOriginPolicy ) {\n\n    function getProtocol( url ) {\n      return url.substring(0, url.indexOf(\"//\"));\n    };\n\n    function getProtocolAndHost( url ) {\n      return url.substring(0, url.indexOf(\"/\", 8));\n    };\n\n    if (!contextUrl) {\n      contextUrl = baseUrl;\n    }\n\n    // protocol-relative path\n    if (url.substring(0,2)==\"//\") {\n      url = getProtocol(contextUrl) + url;\n    }\n\n    // absolute path\n    if (/^https?:\\/\\//i.test(url)) {\n      return !ignoreSameOriginPolicy && getProtocolAndHost(contextUrl) != getProtocolAndHost(url) ? null : url ;\n    }\n\n    // root-relative path\n    if (url.charAt(0)==\"/\")  {\n      return getProtocolAndHost(contextUrl) + url;\n    }\n\n    // relative path\n    var contextUrlPath = contextUrl.split(/[?#]/)[0]; // ignore query string in the contextUrl\n    if (url.charAt(0) != \"?\" && contextUrlPath.charAt(contextUrlPath.length - 1) != \"/\") {\n      contextUrlPath = contextUrlPath.substring(0, contextUrlPath.lastIndexOf(\"/\") + 1);\n    }\n\n    return contextUrlPath + url;\n  };\n\n  // --[ parseStyleSheet() ]----------------------------------------------\n  // Downloads the stylesheet specified by the URL, removes it's comments\n  // and recursivly replaces @import rules with their contents, ultimately\n  // returning the full cssText.\n  function parseStyleSheet( url ) {\n    if (url) {\n      return loadStyleSheet(url).replace(RE_COMMENT, EMPTY_STRING).\n      replace(RE_IMPORT, function( match, quoteChar, importUrl, quoteChar2, importUrl2, media ) {\n        var cssText = parseStyleSheet(resolveUrl(importUrl || importUrl2, url));\n        return (media) ? \"@media \" + media + \" {\" + cssText + \"}\" : cssText;\n      }).\n      replace(RE_ASSET_URL, function( match, isBehavior, quoteChar, assetUrl ) {\n        quoteChar = quoteChar || EMPTY_STRING;\n        return isBehavior ? match : \" url(\" + quoteChar + resolveUrl(assetUrl, url, true) + quoteChar + \") \";\n      });\n    }\n    return EMPTY_STRING;\n  };\n\n  // --[ getStyleSheets() ]-----------------------------------------------\n  function getStyleSheets() {\n    var url, stylesheet;\n    for (var c = 0; c < doc.styleSheets.length; c++) {\n      stylesheet = doc.styleSheets[c];\n      if (stylesheet.href != EMPTY_STRING) {\n        url = resolveUrl(stylesheet.href);\n        if (url) {\n          stylesheet.cssText = stylesheet[\"rawCssText\"] = patchStyleSheet( parseStyleSheet( url ) );\n        }\n      }\n    }\n  };\n\n  // --[ init() ]---------------------------------------------------------\n  function init() {\n    applyPatches();\n\n    // :enabled & :disabled polling script (since we can't hook\n    // onpropertychange event when an element is disabled)\n    if (enabledWatchers.length > 0) {\n      setInterval( function() {\n        for (var c = 0, cl = enabledWatchers.length; c < cl; c++) {\n          var e = enabledWatchers[c];\n          if (e.disabled !== e.$disabled) {\n            if (e.disabled) {\n              e.disabled = false;\n              e.$disabled = true;\n              e.disabled = true;\n            }\n            else {\n              e.$disabled = e.disabled;\n            }\n          }\n        }\n      }, 250)\n    }\n  };\n\n  // Determine the baseUrl and download the stylesheets\n  var baseTags = doc.getElementsByTagName(\"BASE\");\n  var baseUrl = (baseTags.length > 0) ? baseTags[0].href : doc.location.href;\n  getStyleSheets();\n\n  // Bind selectivizr to the ContentLoaded event.\n  ContentLoaded(win, function() {\n    // Determine the \"best fit\" selector engine\n    for (var engine in selectorEngines) {\n      var members, member, context = win;\n      if (win[engine]) {\n        members = selectorEngines[engine].replace(\"*\", engine).split(\".\");\n        while ((member = members.shift()) && (context = context[member])) {}\n        if (typeof context == \"function\") {\n          selectorMethod = context;\n          init();\n          return;\n        }\n      }\n    }\n  });\n\n\n\n  /*!\n   * ContentLoaded.js by Diego Perini, modified for IE<9 only (to save space)\n   *\n   * Author: Diego Perini (diego.perini at gmail.com)\n   * Summary: cross-browser wrapper for DOMContentLoaded\n   * Updated: 20101020\n   * License: MIT\n   * Version: 1.2\n   *\n   * URL:\n   * http://javascript.nwbox.com/ContentLoaded/\n   * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE\n   *\n   */\n\n  // @w window reference\n  // @f function reference\n  function ContentLoaded(win, fn) {\n\n    var done = false, top = true,\n    init = function(e) {\n      if (e.type == \"readystatechange\" && doc.readyState != \"complete\") return;\n      (e.type == \"load\" ? win : doc).detachEvent(\"on\" + e.type, init, false);\n      if (!done && (done = true)) fn.call(win, e.type || e);\n    },\n    poll = function() {\n      try { root.doScroll(\"left\"); } catch(e) { setTimeout(poll, 50); return; }\n      init('poll');\n    };\n\n    if (doc.readyState == \"complete\") fn.call(win, EMPTY_STRING);\n    else {\n      if (doc.createEventObject && root.doScroll) {\n        try { top = !win.frameElement; } catch(e) { }\n        if (top) poll();\n      }\n      addEvent(doc,\"readystatechange\", init);\n      addEvent(win,\"load\", init);\n    }\n  };\n})(this);\n"],"sourceRoot":"/source/"}